<!DOCTYPE>

<html lang="pt-br">

<head>
    <title>cytoscape-euler.js demo</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.5.0/bluebird.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>

    <!-- for testing with local version of cytoscape.js -->
    <!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->

    <script src="js/libs/cytoscape-euler.js"></script>

    <style>
        body {
            font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
            font-size: 14px;
        }

        #cy {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 999;
        }

        h1 {
            opacity: 0.5;
            font-size: 1em;
            font-weight: bold;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            var cy = window.cy = cytoscape({
                container: document.getElementById('cy'),

                // demo your layout
                layout: {
                    name: 'euler',
                    randomize: false,
                    animate: false,
                    // font: <https://stackoverflow.com/questions/54015729/cytoscape-js-spacing-between-nodes>
                    spacingFactor: 4,

                    // some more options here...
                },

                style: [
                    {
                        selector: 'node',
                        style: {
                            'content': 'data(name)',
                            'background-color': '#126814',
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'color': '#fff',
                            'padding': 20,
                            'text-wrap': 'wrap',
                        }
                    },

                    {
                        selector: 'edge',
                        style: {
                            'width': 10,
                            'line-color': '#000',
                            'opacity': 0.3,
                        }
                    },

                    {
                        selector: ':selected',
                        style: {

                        }
                    },

                    {
                        selector: '.highlighted',
                        style: {
                            'background-color': '#61bffc',
                            'line-color': '#61bffc',
                            'target-arrow-color': '#61bffc',
                            'transition-property': 'background-color, line-color, target-arrow-color',
                            'transition-duration': '0.5s'
                        }
                    }
                ],

                elements: fetch('http://localhost:8080/graph').then(async function (res) {
                    const response = await res.json();
                    console.log(response);

                    const edges = [];

                    const nodes = response.nodes.map((node, index) => {

                        const nodeFormated = {
                            "data": {
                                name: node.node,
                                "id": `${node.node}`,
                                "sbgnbbox": {
                                    "x": 10,
                                    "y": 20,
                                    "w": "120.0",
                                    "h": "60.0"
                                },
                                "sbgnclass": "macromolecule",
                                "sbgnlabel": "hexokinase",
                                "sbgnstatesandinfos": [],
                                "ports": [],
                            },
                            "position": {
                                "x": 10,
                                "y": 20,
                            },
                            "group": "nodes",
                            "removed": false,
                            "selected": false,
                            "selectable": true,
                            "locked": false,
                            "grabbable": true,
                            "classes": ""
                        };

                        return nodeFormated;
                    });

                    response.nodes.forEach((node, index) => {
                        const nodeName = node.node;

                        node.edges.forEach(edge => {
                            const formattedEdge = {
                                "data": {
                                    "id": `edge${nodeName}-${edge.node}`,
                                    "sbgnclass": "production",
                                    "sbgncardinality": 0,
                                    "source": nodeName,
                                    "target": edge.node,
                                    "portsource": nodeName,
                                    "porttarget": edge.node,
                                },
                                "position": {},
                                "group": "edges",
                                "removed": false,
                                "selected": false,
                                "selectable": true,
                                "locked": false,
                                "grabbable": true,
                                "classes": (nodeName === "Como") ? ["highlighted"] : [],
                            };

                            edges.push(formattedEdge);
                        });
                    });

                    return [
                        ...nodes,
                        ...edges,
                    ];
                })
            });


        });
    </script>
</head>

<body>
    <h1>cytoscape-euler demo</h1>

    <div id="cy"></div>

</body>

</html>